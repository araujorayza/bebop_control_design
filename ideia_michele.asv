% P{1}=
% 
% -4.5320   -0.0001    0.0000    0.0000   -0.9654   -0.0001    0.0000    0.0000
% -0.0001   -4.5322   -0.0000    0.0000    0.0000   -0.9654   -0.0000    0.0000
% 0.0000   -0.0000    1.5287    0.0000   -0.0000    0.0000   -1.0179    0.0000
% 0.0000    0.0000    0.0000    1.7788   -0.0000   -0.0000   -0.0000   -1.0179
% -0.9654    0.0000   -0.0000   -0.0000    3.3349    0.0001   -0.0000   -0.0000
% -0.0001   -0.9654    0.0000   -0.0000    0.0001    3.3354    0.0000   -0.0000
% 0.0000   -0.0000   -1.0179   -0.0000   -0.0000    0.0000   -1.8512    0.0000
% 0.0000    0.0000    0.0000   -1.0179   -0.0000   -0.0000    0.0000   -2.1530
% 
% P{2}=
% 
% -4.5320   -0.0001    0.0000    0.0000   -0.9654   -0.0001    0.0000    0.0000
% -0.0001   -4.5322   -0.0000    0.0000    0.0000   -0.9654   -0.0000    0.0000
% 0.0000   -0.0000    1.5287    0.0000   -0.0000    0.0000   -1.0179    0.0000
% 0.0000    0.0000    0.0000    1.7788   -0.0000   -0.0000   -0.0000   -1.0179
% -0.9654    0.0000   -0.0000   -0.0000    3.3349    0.0001   -0.0000   -0.0000
% -0.0001   -0.9654    0.0000   -0.0000    0.0001    3.3354    0.0000   -0.0000
% 0.0000   -0.0000   -1.0179   -0.0000   -0.0000    0.0000   -1.8512    0.0000
% 0.0000    0.0000    0.0000   -1.0179   -0.0000   -0.0000    0.0000   -2.1530
% 
% R{1}
% =
% 
% 0.4707    0.0000    0.0000    0.0000    0.0050   -0.0001   -0.0000    0.0000
% 0.0000    0.4707   -0.0000   -0.0000   -0.0001    0.0045   -0.0000   -0.0000
% -0.0000    0.0000    0.5000   -0.0000    0.0000   -0.0000    0.0290    0.0000
% -0.0000    0.0000    0.0000    0.5000   -0.0000   -0.0000    0.0000    0.0280
% -0.0054    0.0001   -0.0000    0.0000    0.4999    0.0012    0.0000   -0.0000
% 0.0001   -0.0049    0.0000    0.0000   -0.0012    0.4999    0.0000    0.0000
% 0.0000    0.0000   -0.0290   -0.0000   -0.0000   -0.0000    0.5000    0.0000
% -0.0000    0.0000   -0.0000   -0.0280    0.0000   -0.0000   -0.0000    0.5000
% 
% R{2}
% =
% 
% 0.4707    0.0000    0.0000    0.0000    0.0050   -0.0001   -0.0000    0.0000
% 0.0000    0.4707   -0.0000   -0.0000   -0.0001    0.0045   -0.0000   -0.0000
% -0.0000    0.0000    0.5000   -0.0000    0.0000   -0.0000    0.0290    0.0000
% -0.0000    0.0000    0.0000    0.5000   -0.0000   -0.0000    0.0000    0.0280
% -0.0054    0.0001   -0.0000    0.0000    0.4999    0.0012    0.0000   -0.0000
% 0.0001   -0.0049    0.0000    0.0000   -0.0012    0.4999    0.0000    0.0000
% 0.0000    0.0000   -0.0290   -0.0000   -0.0000   -0.0000    0.5000    0.0000
% -0.0000    0.0000   -0.0000   -0.0280    0.0000   -0.0000   -0.0000    0.5000
% 
% L{1}
% =
% 
% -0.0028   -0.0001    0.0000   -0.0000   -0.5176    0.0000    0.0000   -0.0000
% -0.0001   -0.0033    0.0000   -0.0000    0.0025   -0.5127    0.0000    0.0000
% 0.0000   -0.0000    0.0232    0.0000    0.0000    0.0000   -0.4289   -0.0000
% -0.0000   -0.0000    0.0000    0.0230   -0.0000   -0.0000    0.0000   -0.4179
% -0.3458   -0.0000   -0.0000   -0.0000    3.3276    0.0003   -0.0000   -0.0000
% -0.0000   -0.3458    0.0000   -0.0000    0.0003    3.3288    0.0000   -0.0000
% 0.0000   -0.0000   -0.6047    0.0000   -0.0000    0.0000   -1.8751   -0.0000
% 0.0000    0.0000   -0.0000   -0.6046   -0.0000   -0.0000   -0.0000   -2.1761
% 
% L{2}
% =
% 
% -0.0028   -0.0001    0.0000   -0.0000   -0.5176    0.0000    0.0000   -0.0000
% -0.0001   -0.0033    0.0000   -0.0000    0.0025   -0.5127    0.0000    0.0000
% 0.0000   -0.0000    0.0232    0.0000    0.0000    0.0000   -0.4289   -0.0000
% -0.0000   -0.0000    0.0000    0.0230   -0.0000   -0.0000    0.0000   -0.4179
% -0.3458   -0.0000   -0.0000   -0.0000    3.3276    0.0003   -0.0000   -0.0000
% -0.0000   -0.3458    0.0000   -0.0000    0.0003    3.3288    0.0000   -0.0000
% 0.0000   -0.0000   -0.6047    0.0000   -0.0000    0.0000   -1.8751   -0.0000
% 0.0000    0.0000   -0.0000   -0.6046   -0.0000   -0.0000   -0.0000   -2.1761

% Rset = 1:size(B,2);
% n = size(A{1},2);
% G=[1,2];

% usar fmincon
h{1} = @(psi) (sin(2*psi)/4 - 1/2)*((538*cos(psi)^2)/747 + (1285*sin(psi)^2)/747 - 1285/747);
h{2} = @(psi) -(sin(2*psi)/4 + 1/2)*((538*cos(psi)^2)/747 + (1285*sin(psi)^2)/747 - 1285/747);
h{3} = @(psi) -(sin(2*psi)/4 - 1/2)*((538*cos(psi)^2)/747 + (1285*sin(psi)^2)/747 - 538/747);
h{4} = @(psi) (sin(2*psi)/4 + 1/2)*((538*cos(psi)^2)/747 + (1285*sin(psi)^2)/747 - 538/747);

dh{1} = @(psi) [ 0, 0, 0, 0, 0, 0, 0,(cos(2*psi)*((538*cos(psi)^2)/747 + (1285*sin(psi)^2)/747 - 1285/747))/2 + 2*cos(psi)*sin(psi)*(sin(2*psi)/4 - 1/2)];
dh{2} = @(psi) [ 0, 0, 0, 0, 0, 0, 0, - (cos(2*psi)*((538*cos(psi)^2)/747 + (1285*sin(psi)^2)/747 - 1285/747))/2 - 2*cos(psi)*sin(psi)*(sin(2*psi)/4 + 1/2)];
dh{3} = @(psi) [  0, 0, 0, 0, 0, 0, 0,- (cos(2*psi)*((538*cos(psi)^2)/747 + (1285*sin(psi)^2)/747 - 538/747))/2 - 2*cos(psi)*sin(psi)*(sin(2*psi)/4 - 1/2)];
dh{4} = @(psi) [ 0, 0, 0, 0, 0, 0, 0, (cos(2*psi)*((538*cos(psi)^2)/747 + (1285*sin(psi)^2)/747 - 538/747))/2 + 2*cos(psi)*sin(psi)*(sin(2*psi)/4 + 1/2)];

V = @(x1,x2,x3,x4,x5,x6,x7,psi) sum(arrayfun(@(k) [x1,x2,x3,x4,x5,x6,x7,psi]*h{k}(psi)*P{k}*[x1,x2,x3,x4,x5,x6,x7,psi]',G));
hdot = @(x1,x2,x3,x4,x5,x6,x7,psi,k) sum(arrayfun(@(j) dh{k}(psi)*h{j}(psi)*A{j}*[x1,x2,x3,x4,x5,x6,x7,psi]',Rset));
Dset = @(x1,x2,x3,x4,x5,x6,x7,psi) sum(arrayfun(@(k) [x1,x2,x3,x4,x5,x5,x7,psi]*hdot(x1,x2,x3,x4,x5,x6,x7,psi,k)*P{k}*[x1,x2,x3,x4,x5,x6,x7,psi]',G));

DV = @(x1,x2,x3,x4,x5,x6,x7,psi) sum(arrayfun(@(j) sum(arrayfun(@(k) [x1,x2,x3,x4,x5,x6,x7,psi]*h{j}(psi)*h{k}(psi)*(A{j}'*P{k}+P{k}*A{j})*[x1,x2,x3,x4,x5,x6,x7,psi]',G)),Rset));
x0 = [0,0,0,0,0,0,0,0];
A = [];
b = [];
Aeq = [];
beq = [];
nonlcon
[x,fval,exitflag,output,lambda,grad,hessian] = fmincon(DV,x0,A,b,Aeq,beq,lb,ub,nonlcon);
